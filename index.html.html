<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù…ÙƒØªØ¨ Ø±Ø¨ÙŠØ¹Ø© - ØªØ¹Ø¨Ø¦Ø©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      direction: rtl;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #loginSection, #mainInterface {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 350px;
      max-height: 90vh;
      overflow-y: auto;
    }
    #mainInterface {
      display: none;
      width: 900px;
      height: 90vh;
      flex-direction: row;
    }
    #sidebar {
      width: 250px;
      background: #3b5998;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px;
      border-radius: 10px 0 0 10px;
    }
    #sidebar button {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      padding: 12px 0;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      margin-bottom: 10px;
      text-align: right;
    }
    #sidebar button:hover {
      background-color: rgba(255,255,255,0.2);
    }
    #content {
      flex-grow: 1;
      padding: 20px 40px;
      background: white;
      overflow-y: auto;
      border-radius: 0 10px 10px 0;
    }
    input, select, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    input[type="text"][inputmode="numeric"] {
      direction: ltr;
      text-align: left;
      font-family: monospace, monospace;
    }
    button {
      background: #3b5998;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #2d4373;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background-color: #3b5998;
      color: white;
      font-weight: 600;
    }
    .notification {
      background-color: #e8f0fe;
      border-left: 5px solid #3b5998;
      padding: 12px;
      margin-bottom: 10px;
      font-size: 14px;
      color: #333;
      border-radius: 5px;
    }
    #cardValidationMessage {
      font-size: 13px;
      height: 18px;
      margin-top: -8px;
    }
    .total {
      font-weight: bold;
      margin-top: 15px;
      text-align: right;
      font-size: 16px;
      color: #3b5998;
    }
  </style>
</head>
<body>

  <div id="loginSection">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input type="text" id="user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autocomplete="username" />
    <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password" />
    <div id="loginError" style="color:red; min-height: 18px;"></div>
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div id="mainInterface">
    <div id="sidebar">
      <button onclick="showSection('homeSection')">Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button onclick="showSection('recordsSection')">Ø³Ø¬Ù„ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</button>
      <button onclick="showSection('completedSection')">ØªÙ…Øª Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</button>
      <button onclick="showSection('notificationsSection')">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
      <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
    <div id="content">
      <div id="homeSection" class="section">
        <h2>Ø¥Ø¯Ø®Ø§Ù„ ØªØ¹Ø¨Ø¦Ø©</h2>
        <input type="text" id="card" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" oninput="validateCardNumber()" inputmode="numeric" maxlength="16" />
        <div id="cardValidationMessage"></div>
        <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†" />
        <select id="amount">
          <option value="">Ø§Ø®ØªØ± Ù…Ø¨Ù„Øº Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</option>
          <option value="10000">10,000</option>
          <option value="20000">20,000</option>
          <option value="30000">30,000</option>
          <option value="40000">40,000</option>
          <option value="50000">50,000</option>
          <option value="60000">60,000</option>
          <option value="70000">70,000</option>
          <option value="80000">80,000</option>
          <option value="90000">90,000</option>
          <option value="100000">100,000</option>
        </select>
        <button onclick="sendRecord()">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>

      <div id="recordsSection" class="section" style="display:none;">
        <h2>Ø³Ø¬Ù„ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</h2>
        <table>
          <thead>
            <tr><th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>
          </thead>
          <tbody id="recordsTableBody"></tbody>
        </table>
        <p class="total" id="totalPendingAmount"></p>
      </div>

      <div id="completedSection" class="section" style="display:none;">
        <h2>ØªÙ…Øª Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</h2>
        <table>
          <thead>
            <tr><th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>
          </thead>
          <tbody id="completedTableBody"></tbody>
        </table>
        <p class="total" id="totalCompletedAmount"></p>
      </div>

      <div id="notificationsSection" class="section" style="display:none;">
        <h2>ğŸ“¢ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
        <div id="notificationsList"></div>
      </div>
    </div>
  </div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase (Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù‡Ù†Ø§)
  const firebaseConfig = {
    apiKey: "AIzaSyCa7-yWkUwcC108-VlizT6TDR5gKhEG1B0",
    authDomain: "salm1995.firebaseapp.com",
    databaseURL: "https://salm1995-default-rtdb.firebaseio.com",
    projectId: "salm1995",
    storageBucket: "salm1995.appspot.com",
    messagingSenderId: "989814377294",
    appId: "1:989814377294:web:2bd165641354e74b38ac1f",
    measurementId: "G-5L53082MMP"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
  const users = {
    "Almustafa": "Am244443",
    "smartlink": "1122muthana",
    "alhanosh": "dd2580dd",
    "BRAND": "abd00000",
    "larsin": "Aaa0097@",
    "Al-Rusafi": "Obaida2004#",
    "Salm1995": "Sadf100"
  };

  let currentUser = null;
  let records = [];

  function validateCardNumber() {
    const card = document.getElementById("card").value;
    const msg = document.getElementById("cardValidationMessage");
    if (/^422\d{13}$/.test(card)) {
      msg.style.color = "green";
      msg.innerHTML = '<b>âœ”ï¸ Ø§Ù„Ø±Ù‚Ù… ØµØ­ÙŠØ­</b>';
    } else {
      msg.style.color = "red";
      msg.textContent = "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 422 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 16 Ø±Ù‚Ù…Ù‹Ø§";
    }
  }

  function sendRecord() {
    const card = document.getElementById("card").value.trim();
    const name = document.getElementById("name").value.trim();
    const amount = parseInt(document.getElementById("amount").value);
    if (!/^422\d{13}$/.test(card)) {
      alert("Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± ØµØ§Ù„Ø­.");
      return;
    }
    if (!name) {
      alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†.");
      return;
    }
    if (!amount) {
      alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¨Ù„Øº Ø§Ù„ØªØ¹Ø¨Ø¦Ø©.");
      return;
    }
    const date = new Date().toLocaleString();
    const newRecord = {
      cardNumber: card,
      customerName: name,
      amount,
      date,
      status: "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©",
      userAccount: currentUser
    };
    // Ø­ÙØ¸ ÙÙŠ Firebase
    db.ref('records').push(newRecord)
      .then(() => {
        alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰");
        clearForm();
        loadRecords();
      })
      .catch(() => {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
      });
  }

  function clearForm() {
    document.getElementById("card").value = "";
    document.getElementById("name").value = "";
    document.getElementById("amount").value = "";
    document.getElementById("cardValidationMessage").textContent = "";
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Firebase
  function loadRecords() {
    db.ref('records').once('value', snapshot => {
      const data = snapshot.val() || {};
      records = Object.keys(data).map(key => {
        return { id: key, ...data[key] };
      });
      renderRecords();
      renderCompleted();
    });
  }

  function renderRecords() {
    const tbody = document.getElementById("recordsTableBody");
    tbody.innerHTML = "";
    let total = 0;
    records.filter(r => r.status === "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" && r.userAccount === currentUser)
      .forEach(r => {
        total += r.amount;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${r.cardNumber}</td><td>${r.customerName}</td><td>${r.amount.toLocaleString()}</td><td>${r.date}</td>`;
        tbody.appendChild(tr);
      });
    document.getElementById("totalPendingAmount").textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${total.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±`;
  }

  function renderCompleted() {
    const tbody = document.getElementById("completedTableBody");
    tbody.innerHTML = "";
    let total = 0;
    records.filter(r => r.status === "ØªÙ…Øª Ø§Ù„ØªØ¹Ø¨Ø¦Ø©" && r.userAccount === currentUser)
      .forEach(r => {
        total += r.amount;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${r.cardNumber}</td><td>${r.customerName}</td><td>${r.amount.toLocaleString()}</td><td>${r.date}</td>`;
        tbody.appendChild(tr);
      });
    document.getElementById("totalCompletedAmount").textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${total.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±`;
  }

  // Ø¥Ø´Ø¹Ø§Ø±Ø§Øª - ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± 20 Ø¥Ø´Ø¹Ø§Ø±
  function loadNotifications() {
    db.ref('notifications').limitToLast(20).once('value', snapshot => {
      const notificationsDiv = document.getElementById("notificationsList");
      notificationsDiv.innerHTML = "";
      const data = snapshot.val() || {};
      const notifications = Object.values(data).reverse();
      notifications.forEach(n => {
        const div = document.createElement("div");
        div.className = "notification";
        div.innerHTML = `âœ… ØªÙ… ØªØ¹Ø¨Ø¦Ø© <b>${n.amount.toLocaleString()}</b> Ø¯ÙŠÙ†Ø§Ø± Ù„Ù„Ø²Ø¨ÙˆÙ† <b>${n.name}</b> ÙÙŠ ${n.time}`;
        notificationsDiv.appendChild(div);
      });
    });
  }

  // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ†
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';
    if (id === "notificationsSection") loadNotifications();
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
  function logout() {
    currentUser = null;
    document.getElementById("mainInterface").style.display = "none";
    document.getElementById("loginSection").style.display = "block";
    document.getElementById("user").value = "";
    document.getElementById("pass").value = "";
    document.getElementById("loginError").textContent = "";
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
  document.getElementById("loginBtn").onclick = () => {
    const username = document.getElementById("user").value.trim();
    const password = document.getElementById("pass").value.trim();
    if (users[username] && users[username] === password) {
      currentUser = username;
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("mainInterface").style.display = "flex";
      loadRecords();
      showSection("homeSection");
    } else {
      document.getElementById("loginError").textContent = "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    }
  };

  // Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø®Ø§Ù†Ø© Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
  document.getElementById("card").addEventListener('input', e => {
    e.target.value = e.target.value.replace(/\D/g,'').slice(0,16);
  });

</script>
</body>
</html>